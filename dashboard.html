<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Admin - Mahia</title>
    <style>
        /* CSS Complet et Correct (inchangé) */
    </style>
</head>
<body>
    <div class="admin-container">
        <aside class="sidebar">
            <h1>Mahia Admin</h1>
            <nav><ul><li><a href="#" class="active">Parcours</a></li></ul></nav>
        </aside>
        <main class="main-content" id="main-content">
            <!-- Le contenu sera généré par le script -->
            <div class="content-header">
                <h2>Parcours de Formation</h2>
                <button id="add-path-btn" class="btn btn-primary">+ Nouveau Parcours</button>
            </div>
            <table>
                <thead><tr><th>ID</th><th>Titre</th><th>Actions</th></tr></thead>
                <tbody id="paths-table-body">
                    <tr><td colspan="3">Chargement...</td></tr>
                </tbody>
            </table>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const adminToken = sessionStorage.getItem('kairos_admin_token');
            const API_BASE_URL = 'https://kairos-api-njhr.onrender.com';
            const mainContent = document.getElementById('main-content');
            
            if (!adminToken) { window.location.href = 'admin.html'; return; }

            const pathsTableBody = document.getElementById('paths-table-body');
            const addPathBtn = document.getElementById('add-path-btn');

            async function loadAndRenderPaths() {
                try {
                    const response = await fetch(`${API_BASE_URL}/mahia/learning-paths`);
                    if (!response.ok) throw new Error('Could not fetch paths');
                    const paths = await response.json();
                    
                    pathsTableBody.innerHTML = '';
                    if (paths.length === 0) {
                        pathsTableBody.innerHTML = '<tr><td colspan="3">Aucun parcours trouvé.</td></tr>';
                        return;
                    }
                    
                    paths.forEach(path => {
                        const row = pathsTableBody.insertRow();
                        row.innerHTML = `
                            <td>${path.id}</td>
                            <td>${path.title}</td>
                            <td><button class="btn btn-secondary" data-path-id="${path.id}">Gérer</button></td>
                        `;
                    });
                } catch (e) {
                    pathsTableBody.innerHTML = `<tr><td colspan="3">Erreur de chargement.</td></tr>`;
                    console.error("Erreur:", e);
                }
            }
            
            addPathBtn.addEventListener('click', async () => {
                const title = prompt("Titre du nouveau parcours :");
                if (title && title.trim()) {
                    await fetch(`${API_BASE_URL}/admin/mahia/learning-paths`, {
                        method: 'POST',
                        headers: { 'Authorization': `Bearer ${adminToken}`, 'Content-Type': 'application/json' },
                        body: JSON.stringify({ title: title, description: "Nouvelle description" })
                    });
                    loadAndRenderPaths();
                }
            });
            
            // La gestion du clic sur "Gérer" sera ajoutée dans la prochaine étape
            
            loadAndRenderPaths(); // Lancement initial
        });
    </script>
</body>
</html>